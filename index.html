<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Meta Ads Advisor • Clydeside Social</title>
  <meta name="description" content="Review a live Meta ads campaign or plan a new one. Get recommendations, creative tests, and KPI targets."/>
  <!-- Cache-busting hints -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <style>
    :root{
      --pink:#ff6680; --blue:#a9dde8; --text:#333; --card:#fff;
      --radius:14px; --shadow:0 8px 18px rgba(0,0,0,.08);
      --muted:#555; --good:#0a8f3c; --warn:#c27c00; --bad:#b00020;
      --line:#e9e9e9;
    }
    *{box-sizing:border-box}
    body{
      font-family:"Arial Rounded MT Bold", Arial, sans-serif;
      margin:0; padding:28px; background:var(--blue); color:var(--text);
      display:flex; justify-content:center;
    }
    .wrap{max-width:880px; width:100%}
    .logo{max-width:180px; display:block; margin:0 auto 10px}
    h1{margin:6px 0 16px; text-align:center; color:var(--pink)}
    .tabs{display:flex; gap:8px; margin:12px auto 16px; justify-content:center; flex-wrap:wrap}
    .tabbtn{
      border:2px solid var(--pink); background:#fff; color:var(--pink);
      padding:10px 14px; border-radius:999px; font-weight:bold; cursor:pointer;
    }
    .tabbtn.active{background:var(--pink); color:#fff}
    .card{
      background:var(--card); border:2px solid var(--pink);
      border-radius:var(--radius); padding:22px; box-shadow:var(--shadow);
    }
    label{display:block; font-weight:bold; margin:12px 0 6px}
    input[type="number"], input[type="text"], select, textarea{
      width:100%; padding:12px; border:1px solid #ddd; border-radius:12px; background:#fff; font-family:inherit;
    }
    textarea{min-height:110px; resize:vertical}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .checks{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px}
    .checks label{font-weight:normal; display:flex; align-items:center; gap:8px; margin:0}
    button.cta{
      width:100%; margin-top:14px; padding:12px 16px; border:0; border-radius:999px;
      color:#fff; font-weight:bold; cursor:pointer;
      background:linear-gradient(135deg, var(--pink), #6a84ff);
      box-shadow:0 8px 18px rgba(0,0,0,.12);
    }
    button.cta:hover{filter:brightness(1.04)}
    .muted{opacity:.9; font-size:.95rem; color:var(--muted)}
    .out{margin-top:18px; background:#fff; border:1px solid #eee; border-radius:12px; padding:16px}
    .out h3{margin:0 0 8px; color:#222}
    .tips{margin:10px 0 0 18px}
    .kpi{border-top:1px dashed var(--line); margin-top:14px; padding-top:14px}
    .note{font-size:.9rem; margin-top:6px; color:var(--muted)}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-size:.8rem; color:#fff; margin-right:6px; margin-bottom:6px}
    .good{background:var(--good)} .warn{background:var(--warn)} .bad{background:var(--bad)}
    .hide{display:none}
    .hr{height:1px; background:var(--line); margin:14px 0}
    .exportbar{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
    }
    .ghost{
      border:2px solid var(--pink); background:#fff; color:var(--pink);
      padding:10px 14px; border-radius:999px; font-weight:bold; cursor:pointer;
    }
    footer{margin-top:16px; text-align:center; font-size:.85rem; opacity:.75}
    #live{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}

    /* Print only the results area */
    @media print{
      body{background:#fff; padding:0}
      .tabs, .card > :not(.out), .exportbar, footer, .logo, h1, .muted{ display:none !important; }
      .out{ border:0; box-shadow:none; margin:0; border-radius:0; }
      .out h3{ margin-top:0 }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <img class="logo" src="logo.png" alt="Clydeside Social logo" onerror="this.style.display='none'">
    <h1>Meta Ads Advisor</h1>
    <p class="muted" style="text-align:center;margin:-4px 0 8px">Review a live campaign or plan a new one — quick, clear guidance you can act on.</p>

    <div class="tabs">
      <button class="tabbtn active" data-tab="review">Review existing campaign</button>
      <button class="tabbtn" data-tab="plan">Plan a new campaign</button>
    </div>

    <!-- REVIEW MODE -->
    <div class="card" id="tab_review">
      <div class="row">
        <div>
          <label for="r_objective">Objective</label>
          <select id="r_objective">
            <option value="traffic">Traffic</option>
            <option value="leads">Leads</option>
            <option value="sales">Sales</option>
            <option value="email">Email list growth</option>
          </select>
        </div>
        <div>
          <label for="r_budget">Daily budget (£)</label>
          <input type="number" id="r_budget" min="0" step="1" placeholder="e.g. 30"/>
        </div>
      </div>

      <label for="r_metrics">Paste your key metrics (quick paste or type)</label>
      <textarea id="r_metrics" placeholder="Examples:
CPM: 9.50
CTR(link): 0.8%
CPC: 1.20
Frequency: 3.6
Spend: 210
Conversions: 2
CPA/CPL: 18.00
ROAS: 180%
Pixel+CAPI: yes"></textarea>

      <div class="row">
        <div>
          <label for="r_days">Campaign length so far (days)</label>
          <input type="number" id="r_days" min="1" step="1" placeholder="e.g. 10"/>
        </div>
        <div>
          <label for="r_pixel">Pixel + CAPI configured?</label>
          <select id="r_pixel">
            <option value="unknown">Not sure</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
      </div>

      <button class="cta" id="reviewBtn">Get diagnosis & next steps</button>

      <div class="exportbar hide" id="review_export">
        <button class="ghost" id="review_copy">Copy results</button>
        <button class="ghost" id="review_pdf">Download PDF</button>
      </div>

      <div id="review_out" class="out hide">
        <h3>Diagnosis</h3>
        <p id="review_summary"></p>
        <div id="review_pills"></div>

        <div class="kpi">
          <h3>Recommended next tests</h3>
          <ul id="review_tests" class="tips"></ul>
          <p class="note">Benchmarks vary by market and season (Q4 can raise CPMs). Treat these as friendly guardrails, not guarantees.</p>
        </div>
      </div>
    </div>

    <!-- PLAN MODE -->
    <div class="card hide" id="tab_plan">
      <label for="p_objective">What do you want?</label>
      <select id="p_objective">
        <option value="traffic">More website visitors (Traffic)</option>
        <option value="leads">More enquiries (Leads)</option>
        <option value="sales">More sales (Conversions)</option>
        <option value="email">Grow my email list</option>
      </select>

      <div class="row">
        <div>
          <label for="p_budget">Daily budget (£)</label>
          <input type="number" id="p_budget" min="0" step="1" placeholder="e.g. 30"/>
        </div>
        <div>
          <label for="p_days">Campaign length (days)</label>
          <input type="number" id="p_days" min="1" step="1" placeholder="e.g. 14"/>
        </div>
      </div>

      <label>Creative types (tick any)</label>
      <div class="checks" id="p_creatives">
        <label><input type="checkbox" id="pc_image"> Image</label>
        <label><input type="checkbox" id="pc_carousel"> Carousel</label>
        <label><input type="checkbox" id="pc_reel"> Reel / Video</label>
        <label><input type="checkbox" id="pc_story"> Stories</label>
      </div>

      <!-- Conditional fields -->
      <div id="p_trafficFields" class="hide">
        <label for="p_optimise">Optimise for</label>
        <select id="p_optimise">
          <option value="lpv">Landing Page Views</option>
          <option value="clicks">Link Clicks</option>
        </select>
      </div>
      <div id="p_leadFields" class="hide">
        <label for="p_leadMethod">Lead method</label>
        <select id="p_leadMethod">
          <option value="instant">Instant Form</option>
          <option value="website">Website form</option>
        </select>
      </div>
      <div id="p_salesFields" class="hide">
        <label for="p_roas">Target ROAS goal (%)</label>
        <input type="number" id="p_roas" min="0" step="0.1" placeholder="e.g. 300"/>
      </div>
      <div id="p_emailFields" class="hide">
        <label for="p_welcome">Welcome + thank-you automation in place?</label>
        <select id="p_welcome">
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <button class="cta" id="planBtn">Get plan</button>

      <div class="exportbar hide" id="plan_export">
        <button class="ghost" id="plan_copy">Copy results</button>
        <button class="ghost" id="plan_pdf">Download PDF</button>
      </div>

      <div id="plan_out" class="out hide">
        <h3>Recommended campaign</h3>
        <p id="p_campaign" class="muted"></p>
        <div class="hr"></div>

        <h3>Creative plan</h3>
        <p id="p_plan"></p>

        <h3>Quick tips</h3>
        <ul id="p_tips" class="tips"></ul>

        <div class="kpi">
          <h3>KPI Watchlist</h3>
          <ul id="p_kpis" class="tips"></ul>
          <p class="note">Beginner-friendly targets. Expect seasonal shifts (e.g., Black Friday/Q4).</p>
        </div>
      </div>
    </div>

    <footer>© Clydeside Social</footer>
  </div>

  <!-- a11y live region -->
  <div id="live" aria-live="polite"></div>

  <script>
    // Tiny helpers
    const $ = id => document.getElementById(id);
    const show = el => el.classList.remove('hide');
    const hide = el => el.classList.add('hide');

    // Tabs
    const tabButtons = document.querySelectorAll('.tabbtn');
    const tabs = { review: $('tab_review'), plan: $('tab_plan') };
    tabButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        tabButtons.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const key = btn.dataset.tab;
        Object.values(tabs).forEach(hide);
        show(tabs[key]);
      });
    });

    // Conditional blocks (Plan)
    const pObj = $('p_objective');
    const pBlocks = {
      traffic: $('p_trafficFields'),
      leads: $('p_leadFields'),
      sales: $('p_salesFields'),
      email: $('p_emailFields'),
    };
    function syncPlanBlocks(){
      Object.values(pBlocks).forEach(hide);
      const v = pObj.value;
      if (pBlocks[v]) show(pBlocks[v]);
    }
    pObj.addEventListener('change', syncPlanBlocks);
    syncPlanBlocks();

    // Review: parse pasted metrics
    function parseMetrics(text){
      const out = {};
      text.split(/\n/).forEach(line=>{
        const l = line.trim();
        if(!l) return;
        const kv = l.split(/[:\-]/,2);
        if(kv.length<2) return;
        const k = kv[0].toLowerCase().replace(/\s+/g,'').replace(/[()]/g,'');
        let v = kv[1].trim().replace(/£/g,'').replace(/%/g,'');
        const num = parseFloat(v);
        out[k] = isNaN(num) ? v.toLowerCase() : num;
      });
      return out;
    }

    // KPI pill
    function pill(label, state){
      const span = document.createElement('span');
      span.className = `pill ${state}`;
      span.textContent = label;
      return span;
    }

    // Diagnosis
    function diagnose(obj, m){
      const pills = [];
      const tests = [];
      const summary = [];

      const get = (keys)=>keys.map(k=>m[k]).find(v=>v!==undefined);
      const cpm = get(['cpm']);
      const ctr = get(['ctrlink','ctr','ctr(link)']);
      const cpc = get(['cpc']);
      const freq = get(['frequency']);
      const roas = get(['roas']);
      const conv = get(['conversions','purchases','leads']);
      const cpa = get(['cpa','cpl']);
      const pixel = (m['pixel+capi']||m['pixel']||'').toString();

      if(typeof cpm==='number'){
        if(cpm<=10) pills.push(pill(`CPM £${cpm.toFixed(2)} ✓`, 'good'));
        else if(cpm<=15) pills.push(pill(`CPM £${cpm.toFixed(2)} (watch)`, 'warn'));
        else pills.push(pill(`CPM £${cpm.toFixed(2)} high`, 'bad'));
      }
      if(typeof ctr==='number'){
        if(ctr>=3) pills.push(pill(`CTR(link) ${ctr.toFixed(2)}% (warm ok)`, 'good'));
        else if(ctr>=1) pills.push(pill(`CTR(link) ${ctr.toFixed(2)}% (cold ok)`, 'warn'));
        else pills.push(pill(`CTR(link) ${ctr.toFixed(2)}% low`, 'bad'));
      }
      if(typeof cpc==='number'){
        if(cpc<=1) pills.push(pill(`CPC £${cpc.toFixed(2)} ✓`, 'good'));
        else if(cpc<=2) pills.push(pill(`CPC £${cpc.toFixed(2)} (watch)`, 'warn'));
        else pills.push(pill(`CPC £${cpc.toFixed(2)} high`, 'bad'));
      }
      if(typeof freq==='number'){
        if(freq<=3) pills.push(pill(`Freq ${freq.toFixed(1)} ✓`, 'good'));
        else pills.push(pill(`Freq ${freq.toFixed(1)} rotate creative`, 'warn'));
      }
      if(obj==='sales' && typeof roas==='number'){
        if(roas>=300) pills.push(pill(`ROAS ${roas.toFixed(0)}% ✓`, 'good'));
        else if(roas>=150) pills.push(pill(`ROAS ${roas.toFixed(0)}% (improve)`, 'warn'));
        else pills.push(pill(`ROAS ${roas.toFixed(0)}% below target`, 'bad'));
      } else if((obj==='leads' || obj==='email') && typeof cpa==='number'){
        if(cpa<=10) pills.push(pill(`CPL £${cpa.toFixed(2)} ✓`, 'good'));
        else if(cpa<=20) pills.push(pill(`CPL £${cpa.toFixed(2)} (ok)`, 'warn'));
        else pills.push(pill(`CPL £${cpa.toFixed(2)} high`, 'bad'));
      }
      if(pixel.includes('yes')) pills.push(pill('Pixel+CAPI ok', 'good'));
      else if(pixel.includes('no')){
        pills.push(pill('Pixel/CAPI missing', 'bad'));
        tests.push('Set up Pixel + CAPI and verify events (PageView, Lead, Purchase).');
      }

      if(typeof ctr==='number' && ctr<1){
        tests.push('Creative refresh: test 3–5 new variants with clearer hooks and simpler visuals.');
      }
      if(typeof freq==='number' && freq>3 && (!conv || conv==0)){
        tests.push('High frequency with low results: duplicate best audience with new creative and reset learning.');
      }
      if(obj==='traffic'){
        tests.push('Optimise for Landing Page Views if possible; improve page speed and clarity.');
      }
      if(obj==='leads'){
        tests.push('If Instant Form, keep it short (name + email). If Website form, ensure fast LP and strong value prop.');
      }
      if(obj==='sales'){
        tests.push('Use Advantage+ Shopping or Catalog sales if ecommerce; include a warm retargeting set.');
      }
      if(obj==='email'){
        tests.push('Lead magnet: deliver via email and ensure a welcome sequence nudges the next action.');
      }

      if(pills.length===0) pills.push(pill('Add more metrics for a better diagnosis', 'warn'));
      summary.push('Based on the metrics provided, here are the key signals and recommended next tests.');

      return { summary: summary.join(' '), pills, tests };
    }

    // REVIEW handler
    const reviewOut = $('review_out');
    const reviewExport = $('review_export');
    $('reviewBtn').addEventListener('click', ()=>{
      const obj = $('r_objective').value;
      const metrics = parseMetrics($('r_metrics').value);
      const d = diagnose(obj, metrics);

      $('review_summary').textContent = d.summary;

      const pillBox = $('review_pills');
      pillBox.innerHTML = '';
      d.pills.forEach(p=>pillBox.appendChild(p));

      const ul = $('review_tests');
      ul.innerHTML = '';
      [...new Set(d.tests)].slice(0,6).forEach(t=>{
        const li=document.createElement('li'); li.textContent=t; ul.appendChild(li);
      });

      show(reviewOut);
      show(reviewExport);
      $('live').textContent = 'Review advice ready';
    });

    // PLAN handler
    function getPlan(){
      const obj = $('p_objective').value;
      const budget = Math.max(0, +$('p_budget').value || 0);
      const days = Math.max(1, +$('p_days').value || 1);
      const creatives = [
        $('pc_image').checked ? 'Image' : null,
        $('pc_carousel').checked ? 'Carousel' : null,
        $('pc_reel').checked ? 'Reel/Video' : null,
        $('pc_story').checked ? 'Stories' : null
      ].filter(Boolean);

      const optimiseFor = $('p_optimise')?.value || null;
      const leadMethod = $('p_leadMethod')?.value || null;
      const roasGoal = +($('p_roas')?.value || 0);
      const welcomeFlow = $('p_welcome')?.value || null;

      let campaignType = '';
      const tips = [];

      if (obj==='traffic'){
        campaignType = (optimiseFor==='clicks')
          ? 'Traffic (optimise for Link Clicks)'
          : 'Traffic (optimise for Landing Page Views)';
        tips.push('Make the landing page fast and clear (reduce bounces).');
        tips.push('Use a strong, singular call-to-action on page.');
        if (optimiseFor!=='lpv') tips.push('If available, switch to LPV for better quality.');
      } else if (obj==='leads'){
        campaignType = (leadMethod==='instant')
          ? 'Lead Generation (Instant Forms)'
          : 'Leads to Website (Conversions to form submit)';
        tips.push('Offer a clear value exchange (guide, discount, webinar).');
        tips.push('Keep forms short — name + email to start.');
      } else if (obj==='sales'){
        campaignType = 'Sales / Conversions (with Pixel + CAPI)';
        tips.push('Verify your purchase event (Pixel + CAPI).');
        tips.push('Use Advantage+ Shopping or Catalog if you sell products.');
        if (roasGoal) tips.push(`Test towards ROAS ≈ ${roasGoal}% (break-even and up).`);
      } else if (obj==='email'){
        campaignType = 'Leads (List Growth)';
        tips.push('Give a useful lead magnet (checklist, template or mini-guide).');
        if (welcomeFlow==='no') tips.push('Set a welcome + thank-you automation before launching.');
        else tips.push('Ensure the welcome flow nudges the next step (book/call/browse).');
      }

      const adSets = budget >= 60 ? 2 : 1;
      const variants = creatives.length ? Math.min(5, creatives.length * 2) : 3;
      const useStories = creatives.includes('Stories');

      const plan = `Run ${adSets} ad set${adSets>1?'s':''} with ${variants} creative variants total across ${creatives.length?creatives.join(', '):'at least 2 formats (e.g. Image + Reel)'}.
${useStories ? 'Add a Stories cut for anything vertical.' : 'Consider a Stories version to capture vertical placements.'}`;

      const generic = [
        'Use 3–5 creatives to find a winner quickly.',
        'Refresh ads every 2–3 weeks to avoid fatigue.',
        'Add a retargeting ad for warm viewers/clickers.',
        'Keep copy clear, short and human.',
        'Use plain backgrounds and bold text for clarity.'
      ];
      while (tips.length < 3) tips.push(generic.shift());
      if (tips.length < 5) tips.push('Add UTMs and check post-click behaviour in GA.');

      const kpis = [];
      kpis.push('Frequency: if it creeps over 3 and sales/leads aren’t coming, change creative or copy.');
      kpis.push('CPM: aim under £10 if possible (can spike in peak seasons).');
      if (obj==='traffic' || obj==='email' || obj==='leads') {
        kpis.push('CTR (link) — Warm audiences: target ≥ 3%.');
        kpis.push('CTR (link) — Cold audiences: target ≥ 1%.');
      }
      if (obj==='sales' && roasGoal){
        kpis.push(`ROAS goal: ≈ ${roasGoal}% (use as a guide while testing).`);
      } else if (obj==='sales'){
        kpis.push('ROAS: set a % goal (e.g., 300%) and give tests 3–7 days to learn.');
      }

      return { campaignType, plan, tips, kpis };
    }

    const planOut = $('plan_out');
    const planExport = $('plan_export');
    $('planBtn').addEventListener('click', ()=>{
      const r = getPlan();
      $('p_campaign').textContent = r.campaignType;
      $('p_plan').textContent = r.plan;

      const tipsUl = $('p_tips'); tipsUl.innerHTML='';
      r.tips.slice(0,5).forEach(t=>{ const li=document.createElement('li'); li.textContent=t; tipsUl.appendChild(li); });

      const kpiUl = $('p_kpis'); kpiUl.innerHTML='';
      r.kpis.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; kpiUl.appendChild(li); });

      show(planOut);
      show(planExport);
      $('live').textContent = 'Plan advice ready';
    });

    // -------- Export helpers (copy + PDF/print) --------
    function collectTextFrom(container){
      const lines = [];
      container.querySelectorAll('h3, p, li, .pill').forEach(el=>{
        const tag = el.tagName.toLowerCase();
        if(tag==='h3'){ lines.push(`\n## ${el.textContent.trim()}`); }
        else if(tag==='li'){ lines.push(`- ${el.textContent.trim()}`); }
        else { const t = el.textContent.trim(); if(t) lines.push(t); }
      });
      return lines.join('\n');
    }

    async function copyResults(container){
      const txt = collectTextFrom(container).trim();
      if(!txt){ alert('No results to copy yet.'); return; }
      try{
        await navigator.clipboard.writeText(txt);
        alert('Results copied to clipboard ✅');
      }catch(e){
        // fallback
        const ta=document.createElement('textarea');
        ta.value = txt; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        alert('Results copied to clipboard ✅');
      }
    }

    function printSection(container){
      // Temporarily show only the container by toggling classes, then window.print()
      // Our @media print hides everything except .out within .card — so just ensure this .out is visible.
      if(container.classList.contains('hide')){ alert('Generate results first.'); return; }
      window.print();
    }

    // Wire buttons
    $('review_copy').addEventListener('click', ()=>copyResults(reviewOut));
    $('plan_copy').addEventListener('click', ()=>copyResults(planOut));
    $('review_pdf').addEventListener('click', ()=>printSection(reviewOut));
    $('plan_pdf').addEventListener('click', ()=>printSection(planOut));

  </script>
</body>
</html>
